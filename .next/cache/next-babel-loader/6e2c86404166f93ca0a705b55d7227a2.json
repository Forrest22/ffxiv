{"ast":null,"code":"var __jsx = React.createElement;\n\nfunction _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nimport React, { useState, useRef, useEffect } from 'react';\nimport moment from 'moment';\nimport { makeStyles } from '@material-ui/core/styles';\nimport EorzeaWeather, { chances } from '@pillowfication/eorzea-weather';\nimport forecastWeather from './forecast-weather';\nimport REGIONS from './regions';\nimport getEorzeanTime from './get-eorzean-time';\nimport Section from '../Section';\nimport Typography from '@material-ui/core/Typography';\nimport Grid from '@material-ui/core/Grid';\nimport TableContainer from '@material-ui/core/TableContainer';\nimport Table from '@material-ui/core/Table';\nimport TableBody from '@material-ui/core/TableBody';\nimport TableRow from '@material-ui/core/TableRow';\nimport TableCell from '@material-ui/core/TableCell';\nimport FormGroup from '@material-ui/core/FormGroup';\nimport FormLabel from '@material-ui/core/FormLabel';\nimport FormControl from '@material-ui/core/FormControl';\nimport FormControlLabel from '@material-ui/core/FormControlLabel';\nimport InputLabel from '@material-ui/core/InputLabel';\nimport TextField from '@material-ui/core/TextField';\nimport Select from '@material-ui/core/Select';\nimport Checkbox from '@material-ui/core/Checkbox';\nimport MenuItem from '@material-ui/core/MenuItem';\nimport Autocomplete from '@material-ui/lab/Autocomplete';\nimport ArrowDownwardIcon from '@material-ui/icons/ArrowDownward';\nimport ArrowForwardIcon from '@material-ui/icons/ArrowForward';\nimport WeatherIcon from './WeatherIcon';\nconst ZONES = [];\n\nfor (const {\n  regionId,\n  zones\n} of REGIONS) {\n  for (const zoneId of zones) {\n    ZONES.push({\n      regionId,\n      zoneId\n    });\n  }\n}\n\nconst WEATHER_CELL_WIDTH = 75;\nconst eorzeaWeather = new EorzeaWeather({\n  locale: 'en'\n});\n\nfunction displayBell(bell) {\n  return bell > 9 ? bell + ':00' : '0' + bell + ':00';\n}\n\nconst useStyles = makeStyles(theme => ({\n  transitionWeather: {\n    [theme.breakpoints.down('sm')]: {\n      marginBottom: theme.spacing(2)\n    }\n  },\n  transitionArrow: {\n    display: 'block',\n    margin: `${theme.spacing(0.5)}px auto`,\n    fontSize: '2em',\n    [theme.breakpoints.down('sm')]: {\n      display: 'none'\n    }\n  },\n  dateCell: {\n    width: '100px',\n    textAlign: 'right'\n  },\n  forecastCell: {\n    whiteSpace: 'nowrap'\n  },\n  bellCell: {\n    width: 50,\n    paddingLeft: theme.spacing(0.5),\n    paddingRight: theme.spacing(0.5),\n    textAlign: 'right'\n  },\n  weatherCell: {\n    width: WEATHER_CELL_WIDTH + theme.spacing(1),\n    paddingLeft: theme.spacing(0.5),\n    paddingRight: theme.spacing(0.5),\n    textAlign: 'center',\n    verticalAlign: 'top',\n    lineHeight: 1,\n    '& span': {\n      display: 'inline-block',\n      width: WEATHER_CELL_WIDTH,\n      lineHeight: 1.1\n    },\n    '&:last-child': {\n      paddingRight: theme.spacing(5),\n      width: WEATHER_CELL_WIDTH + theme.spacing(5.5)\n    }\n  },\n  transitionCell: {\n    width: 50,\n    padding: theme.spacing(1),\n    textAlign: 'center'\n  }\n}));\n\nconst Forecaster = ({\n  now\n}) => {\n  const {\n    0: zone,\n    1: setZone\n  } = useState(null);\n  const {\n    0: transitionWeather,\n    1: setTransitionWeather\n  } = useState('none');\n  const {\n    0: targetWeather,\n    1: setTargetWeather\n  } = useState('none');\n  const {\n    0: times,\n    1: setTimes\n  } = useState({\n    0: true,\n    8: true,\n    16: true\n  });\n  const cachedForecast = useRef(null);\n  const classes = useStyles();\n  useEffect(() => {\n    if (!now || getEorzeanTime(now).getUTCMinutes() === 0) {\n      cachedForecast.current = null;\n    }\n  });\n  const possibleWeathers = zone && chances[zone.zoneId].map(({\n    w: weatherId\n  }) => weatherId);\n  const hasTime = times[0] || times[8] || times[16];\n  const forecast = zone && hasTime && (cachedForecast.current || (cachedForecast.current = forecastWeather(zone.zoneId, now, transitionWeather === 'none' ? null : transitionWeather, targetWeather === 'none' ? null : targetWeather, times)));\n\n  const handleSelectZone = (event, newZone) => {\n    cachedForecast.current = null;\n    setZone(newZone);\n    setTransitionWeather('none');\n    setTargetWeather('none');\n  };\n\n  const handleSelectTransitionWeather = event => {\n    cachedForecast.current = null;\n    setTransitionWeather(event.target.value);\n  };\n\n  const handleSelectTargetWeather = event => {\n    cachedForecast.current = null;\n    setTargetWeather(event.target.value);\n  };\n\n  const handleSelectTimes = timeSlot => {\n    cachedForecast.current = null;\n    setTimes(_objectSpread(_objectSpread({}, times), {}, {\n      [timeSlot]: !times[timeSlot]\n    }));\n  };\n\n  return __jsx(Section, {\n    title: \"Forecaster\"\n  }, __jsx(Grid, {\n    container: true,\n    spacing: 2\n  }, __jsx(Grid, {\n    item: true,\n    xs: 12,\n    md: 4\n  }, __jsx(Autocomplete, {\n    options: ZONES,\n    groupBy: zone => eorzeaWeather.translateRegion(zone.regionId),\n    getOptionLabel: option => eorzeaWeather.translateZone(option.zoneId),\n    renderInput: params => __jsx(TextField, _extends({}, params, {\n      label: \"Select a zone\"\n    })),\n    value: zone,\n    getOptionSelected: (opt1, opt2) => opt1.zoneId === opt2.zoneId,\n    onChange: handleSelectZone\n  })), __jsx(Grid, {\n    item: true,\n    xs: 12,\n    md: 4\n  }, __jsx(FormControl, {\n    fullWidth: true,\n    className: classes.transitionWeather\n  }, __jsx(InputLabel, null, \"Transition from\"), __jsx(Select, {\n    value: transitionWeather,\n    disabled: !zone,\n    onChange: handleSelectTransitionWeather\n  }, __jsx(MenuItem, {\n    value: \"none\"\n  }, possibleWeathers ? 'Any weather' : 'Select a zone first'), possibleWeathers && possibleWeathers.map(weather => __jsx(MenuItem, {\n    key: weather,\n    value: weather\n  }, eorzeaWeather.translateWeather(weather))))), __jsx(ArrowDownwardIcon, {\n    className: classes.transitionArrow\n  }), __jsx(FormControl, {\n    fullWidth: true\n  }, __jsx(InputLabel, null, \"Target weather\"), __jsx(Select, {\n    value: targetWeather,\n    disabled: !zone,\n    onChange: handleSelectTargetWeather\n  }, __jsx(MenuItem, {\n    value: \"none\"\n  }, possibleWeathers ? 'Any weather' : 'Select a zone first'), possibleWeathers && possibleWeathers.map(weather => __jsx(MenuItem, {\n    key: weather,\n    value: weather\n  }, eorzeaWeather.translateWeather(weather)))))), __jsx(Grid, {\n    item: true,\n    xs: 12,\n    md: 4\n  }, __jsx(FormControl, {\n    component: \"fieldset\"\n  }, __jsx(FormLabel, {\n    component: \"legend\"\n  }, \"Select times\"), __jsx(FormGroup, null, __jsx(FormControlLabel, {\n    control: __jsx(Checkbox, {\n      checked: times[0],\n      onChange: handleSelectTimes.bind(null, 0)\n    }),\n    label: \"00:00\"\n  }), __jsx(FormControlLabel, {\n    control: __jsx(Checkbox, {\n      checked: times[8],\n      onChange: handleSelectTimes.bind(null, 8)\n    }),\n    label: \"08:00\"\n  }), __jsx(FormControlLabel, {\n    control: __jsx(Checkbox, {\n      checked: times[16],\n      onChange: handleSelectTimes.bind(null, 16)\n    }),\n    label: \"16:00\"\n  })))), zone && !hasTime && __jsx(Grid, {\n    item: true,\n    xs: 12\n  }, __jsx(Typography, null, __jsx(\"strong\", null, \"Error:\"), \" At least one time must be selected.\")), forecast && __jsx(Grid, {\n    item: true,\n    xs: 12\n  }, __jsx(Typography, {\n    variant: \"h6\",\n    gutterBottom: true\n  }, \"Next 10 matches\"), __jsx(TableContainer, null, __jsx(Table, {\n    size: \"small\",\n    className: classes.weatherTable\n  }, __jsx(TableBody, null, (() => {\n    let previousDate = '';\n    return forecast.map(({\n      date,\n      timeChunk,\n      previousWeather,\n      currentWeather\n    }, index) => {\n      const momentDate = moment(date);\n      const currentDate = momentDate.format('MM/DD');\n      return __jsx(TableRow, {\n        key: index,\n        hover: true\n      }, __jsx(TableCell, {\n        className: classes.dateCell\n      }, __jsx(Typography, null, previousDate !== (previousDate = currentDate) ? currentDate : null)), __jsx(TableCell, {\n        className: classes.dateCell\n      }, __jsx(Typography, null, momentDate.format('HH:mm'))), __jsx(TableCell, {\n        className: classes.forecastCell\n      }, __jsx(Typography, null, moment.duration(momentDate.diff(now)).humanize(true))), __jsx(TableCell, {\n        className: classes.bellCell\n      }, __jsx(Typography, null, displayBell((timeChunk + 16) % 24))), __jsx(TableCell, {\n        className: classes.weatherCell\n      }, __jsx(WeatherIcon, {\n        weatherId: previousWeather\n      })), __jsx(TableCell, {\n        className: classes.transitionCell\n      }, __jsx(ArrowForwardIcon, null)), __jsx(TableCell, {\n        className: classes.bellCell\n      }, __jsx(Typography, null, displayBell(timeChunk))), __jsx(TableCell, {\n        className: classes.weatherCell\n      }, __jsx(WeatherIcon, {\n        weatherId: currentWeather\n      })));\n    });\n  })()))))));\n};\n\nexport default Forecaster;","map":null,"metadata":{},"sourceType":"module"}