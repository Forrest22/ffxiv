{"ast":null,"code":"import { jsx as _jsx } from \"react/jsx-runtime\";\nimport React, { useEffect, useRef, useState } from 'react';\nconst CHOCOBO_BOUNDS = {\n  x: 11,\n  y: 3,\n  width: 135,\n  height: 173\n};\nconst SADDLE_BOUNDS = {\n  x: 148,\n  y: 0,\n  width: 88,\n  height: 121\n};\nconst FEET_BOUNDS = {\n  x: 151,\n  y: 128,\n  width: 81,\n  height: 74\n};\n\nfunction addImageData(source, imageData, x, y) {\n  for (let i = 0; i < imageData.width; ++i) {\n    for (let j = 0; j < imageData.height; ++j) {\n      const u = x + i;\n      const v = y + j;\n      const sD = source.data;\n      const nD = imageData.data;\n      const sI = (v * source.width + u) * 4;\n      const nI = (j * imageData.width + i) * 4;\n      const [sR, sG, sB, sA] = [sD[sI + 0] / 255, sD[sI + 1] / 255, sD[sI + 2] / 255, sD[sI + 3] / 255];\n      const [nR, nG, nB, nA] = [nD[nI + 0] / 255, nD[nI + 1] / 255, nD[nI + 2] / 255, nD[nI + 3] / 255];\n      const a = 1 - (1 - nA) * (1 - sA);\n      sD[sI + 0] = (nR * nA / a + sR * sA * (1 - nA) / a) * 255;\n      sD[sI + 1] = (nG * nA / a + sG * sA * (1 - nA) / a) * 255;\n      sD[sI + 2] = (nB * nA / a + sB * sA * (1 - nA) / a) * 255;\n      sD[sI + 3] = a * 255;\n    }\n  }\n\n  console.log(source);\n}\n\nfunction drawChocobo(ctx, imageData, color) {\n  const chocoboImageData = ctx.createImageData(136, 219);\n  const stainedChocoboImageData = ctx.createImageData(imageData.chocobo);\n\n  for (let i = 0; i < stainedChocoboImageData.data.length; i += 4) {\n    stainedChocoboImageData.data[i + 0] = imageData.chocobo.data[i + 0] / 255 * color.R;\n    stainedChocoboImageData.data[i + 1] = imageData.chocobo.data[i + 1] / 255 * color.G;\n    stainedChocoboImageData.data[i + 2] = imageData.chocobo.data[i + 2] / 255 * color.B;\n    stainedChocoboImageData.data[i + 3] = imageData.chocobo.data[i + 3];\n  }\n\n  addImageData(chocoboImageData, stainedChocoboImageData, 1, 0);\n  addImageData(chocoboImageData, imageData.saddle, 0, 3);\n  addImageData(chocoboImageData, imageData.feet, 17, 145);\n  return chocoboImageData;\n}\n\nconst ChocoboCompanionPreview = ({\n  color\n}) => {\n  const canvasRef = useRef(null);\n  const {\n    0: imageData,\n    1: setImageData\n  } = useState(null);\n  useEffect(() => {\n    const canvas = document.createElement('canvas');\n    const ctx = canvas.getContext('2d');\n    const image = new Image();\n    image.addEventListener('load', () => {\n      canvas.width = image.width;\n      canvas.height = image.height;\n      ctx.drawImage(image, 0, 0, image.width, image.height);\n      setImageData({\n        chocobo: ctx.getImageData(CHOCOBO_BOUNDS.x, CHOCOBO_BOUNDS.y, CHOCOBO_BOUNDS.width, CHOCOBO_BOUNDS.height),\n        saddle: ctx.getImageData(SADDLE_BOUNDS.x, SADDLE_BOUNDS.y, SADDLE_BOUNDS.width, SADDLE_BOUNDS.height),\n        feet: ctx.getImageData(FEET_BOUNDS.x, FEET_BOUNDS.y, FEET_BOUNDS.width, FEET_BOUNDS.height)\n      });\n    }, false);\n    image.src = '/images/chocobo-color/chocobo-companion.png';\n  }, []);\n  useEffect(() => {\n    if (imageData) {\n      const ctx = canvasRef.current.getContext('2d');\n      ctx.putImageData(drawChocobo(ctx, imageData, color), 0, 0);\n    }\n  }, [imageData, color]);\n\n  if (!imageData) {\n    return /*#__PURE__*/_jsx(\"div\", {\n      children: \"Loading...\"\n    });\n  } else {\n    return /*#__PURE__*/_jsx(\"canvas\", {\n      ref: canvasRef,\n      width: 136,\n      height: 219\n    });\n  }\n};\n\nexport default ChocoboCompanionPreview;","map":null,"metadata":{},"sourceType":"module"}